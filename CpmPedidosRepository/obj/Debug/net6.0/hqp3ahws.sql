CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE tb_categoria_produto (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Active" boolean NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_categoria_produto" PRIMARY KEY ("Id")
);

CREATE TABLE tb_cidade (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    uf character varying(2) NOT NULL,
    "Active" boolean NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_cidade" PRIMARY KEY ("Id")
);

CREATE TABLE tb_produto (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Code" character varying(50) NOT NULL,
    "Description" character varying(100) NOT NULL,
    "Price" numeric(17,2) NOT NULL,
    "Id_category_product" integer NOT NULL,
    "Active" boolean NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_produto" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_produto_tb_categoria_produto_Id_category_product" FOREIGN KEY ("Id_category_product") REFERENCES tb_categoria_produto ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_endereco (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Type" smallint NOT NULL,
    "Street" character varying(100) NOT NULL,
    "District" character varying(75) NOT NULL,
    "Number" character varying(10) NOT NULL,
    "Complement" character varying(75) NOT NULL,
    "Cep" character varying(8) NOT NULL,
    "Id_City" integer NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_endereco" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_endereco_tb_cidade_Id_City" FOREIGN KEY ("Id_City") REFERENCES tb_cidade ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_imagem (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "File_Name" character varying(50) NOT NULL,
    "Main" boolean NOT NULL,
    "ProductId" integer NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_imagem" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_imagem_tb_produto_ProductId" FOREIGN KEY ("ProductId") REFERENCES tb_produto ("Id")
);

CREATE TABLE tb_cliente (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(60) NOT NULL,
    "Cpf" character varying(11) NOT NULL,
    "Id_Address" integer NOT NULL,
    "Active" boolean NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_cliente" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_cliente_tb_endereco_Id_Address" FOREIGN KEY ("Id_Address") REFERENCES tb_endereco ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_combo (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(60) NOT NULL,
    "Price" numeric(17,2) NOT NULL,
    "Id_image" integer NOT NULL,
    "Active" boolean NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_combo" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_combo_tb_imagem_Id_image" FOREIGN KEY ("Id_image") REFERENCES tb_imagem ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_promocao_produto (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Price" numeric(17,2) NOT NULL,
    "Id_image" integer NOT NULL,
    "Id_product" integer NOT NULL,
    "Active" boolean NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_promocao_produto" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_promocao_produto_tb_imagem_Id_image" FOREIGN KEY ("Id_image") REFERENCES tb_imagem ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_tb_promocao_produto_tb_produto_Id_product" FOREIGN KEY ("Id_product") REFERENCES tb_produto ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_pedido (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Number" character varying(10) NOT NULL,
    "Amount" numeric(17,2) NOT NULL,
    "Delivery" interval NOT NULL,
    "Id_client" integer NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_pedido" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_pedido_tb_cliente_Id_client" FOREIGN KEY ("Id_client") REFERENCES tb_cliente ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_product_combo (
    id_product integer NOT NULL,
    id_combo integer NOT NULL,
    CONSTRAINT "PK_tb_product_combo" PRIMARY KEY (id_product, id_combo),
    CONSTRAINT "FK_tb_product_combo_tb_combo_id_combo" FOREIGN KEY (id_combo) REFERENCES tb_combo ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_tb_product_combo_tb_produto_id_product" FOREIGN KEY (id_product) REFERENCES tb_produto ("Id") ON DELETE CASCADE
);

CREATE TABLE tb_produto_pedido (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Quantity" integer NOT NULL,
    "Price" numeric(17,2) NOT NULL,
    "Id_product" integer NOT NULL,
    "Id_request" integer NOT NULL,
    "Created_In" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_tb_produto_pedido" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_tb_produto_pedido_tb_pedido_Id_request" FOREIGN KEY ("Id_request") REFERENCES tb_pedido ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_tb_produto_pedido_tb_produto_Id_request" FOREIGN KEY ("Id_request") REFERENCES tb_produto ("Id") ON DELETE CASCADE
);

CREATE UNIQUE INDEX "IX_tb_cliente_Id_Address" ON tb_cliente ("Id_Address");

CREATE INDEX "IX_tb_combo_Id_image" ON tb_combo ("Id_image");

CREATE INDEX "IX_tb_endereco_Id_City" ON tb_endereco ("Id_City");

CREATE INDEX "IX_tb_imagem_ProductId" ON tb_imagem ("ProductId");

CREATE INDEX "IX_tb_pedido_Id_client" ON tb_pedido ("Id_client");

CREATE INDEX "IX_tb_product_combo_id_combo" ON tb_product_combo (id_combo);

CREATE INDEX "IX_tb_produto_Id_category_product" ON tb_produto ("Id_category_product");

CREATE INDEX "IX_tb_produto_pedido_Id_request" ON tb_produto_pedido ("Id_request");

CREATE INDEX "IX_tb_promocao_produto_Id_image" ON tb_promocao_produto ("Id_image");

CREATE INDEX "IX_tb_promocao_produto_Id_product" ON tb_promocao_produto ("Id_product");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20221108200627_Init', '6.0.10');

COMMIT;

